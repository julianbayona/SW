<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>PWA Service Worker Demo</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        img  { display: block; margin: 12px 0; cursor: pointer; border: 2px solid #ccc; border-radius: 8px; }
        button { margin: 4px; padding: 8px 16px; cursor: pointer; }
        #status { margin-top: 10px; font-size: 0.9em; color: #444; }
    </style>
</head>
<script>
    const img = new Image();
    navigator.serviceWorker.register('sw.js')
        .then(reg => console.log('SW registrado!', reg))
        .catch(err => console.log(err));

    setTimeout(() => {
        img.src = 'dog.svg';
        document.body.appendChild(img);
    }, 3000);

    // â”€â”€ Funcionalidad 1: cambiar dog â†’ cat al hacer clic â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    img.addEventListener('click', () => {
        if (navigator.serviceWorker.controller) {
            navigator.serviceWorker.controller.postMessage({ action: 'switchToCat' });
            if (img.src.includes('cat.svg')) {
                img.src = 'dog.svg';
            } else {
                img.src = 'cat.svg?t=' + Date.now();
            }
            console.log('Click en la imagen');
        }
    });

    function sendMessage(action) {
        if (navigator.serviceWorker.controller) {
            navigator.serviceWorker.controller.postMessage({ action });
        }
    }

    // â”€â”€ Funcionalidad 2: bloqueo de imÃ¡genes SVG â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function toggleBloqueo() {
        sendMessage('toggleBlock');
        img.src = img.src.includes('?') ? img.src.split('?')[0] + '?t=' + Date.now() : img.src + '?t=' + Date.now();
        document.getElementById('status').textContent = 'Bloqueo de imÃ¡genes alternado. Recarga la imagen para ver el efecto.';
    }

    // â”€â”€ Funcionalidad 3: modo offline / cachÃ© primero â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function toggleOffline() {
        sendMessage('toggleOffline');
        document.getElementById('status').textContent = 'Modo offline alternado. Las siguientes peticiones usarÃ¡n cachÃ© primero.';
    }
</script>

<body>
    <p>Una imagen aparecerÃ¡ en breves momentos (haz clic en ella para cambiarla):</p>

    <div>
        <button onclick="toggleBloqueo()">ðŸš« Activar / Desactivar bloqueo de imÃ¡genes</button>
        <button onclick="toggleOffline()">ðŸ“¶ Activar / Desactivar modo offline (cachÃ© primero)</button>
    </div>

    <p id="status"></p>
</body>
</html>